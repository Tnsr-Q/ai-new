name: ğŸš€ Deploy AI Tools Tracker

on:
  push:
    branches: [main]
  schedule:
    - cron: '0 12 * * *'  # Daily at 8:00 AM ET (12:00 UTC)
  workflow_dispatch:

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
      
    steps:
      - name: ğŸ› ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3.3'
          use-public-rspm: true

      - name: ğŸ“¦ Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev

      - name: ğŸ“Š Set up Quarto
        uses: quarto-dev/quarto-actions/setup@v2
        with:
          version: 'release'

      - name: ğŸ”§ Restore renv snapshot
        shell: Rscript {0}
        run: |
          if (!requireNamespace("renv", quietly = TRUE)) install.packages("renv")
          renv::restore()

      - name: ğŸ—ï¸ Render Quarto site
        run: |
          quarto render
        working-directory: ./ai-tools-tracker

      - name: ğŸ“¤ Setup Pages
        uses: actions/configure-pages@v3

      - name: ğŸš€ Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: './ai-tools-tracker/_site'

      - name: ğŸŒ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2